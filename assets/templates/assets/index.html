{% extends 'assets/base.html' %}
{% load i18n %}
{% load humanize %}
{% load static %}
{% load assets %}

{% block page_title %}
    {{ title }} â‹— {% translate "Assets" %}
{% endblock %}

{% block assets_block %}
	<div class="card">
		<div id="card-assets">
			<div class="panel panel-default panel-tabs">
				<div class="panel-body">
					<div class="card-body bg-secondary tab-content rounded-bottom">
						{% include 'assets/partials/table/assets.html' %}
						{% include 'assets/partials/table/requests.html' %}
					</div>
				</div>
			</div>
    	</div>
	</div>
{% endblock %}

{% block extra_javascript %}
    {% assets_static 'js/modal-system.js' %}

    {% include 'assets/partials/modal/single-order.html' %}

    {% include 'assets/partials/modal/confirm.html' %}

    {% include 'bundles/datatables-js-bs5.html' %}
    {% include "bundles/moment-js.html" with locale=True %}
    {% include "bundles/filterdropdown-js.html" %}

    {% include 'assets/bundles/settings-bundles.html' %}

    {% include 'assets/bundles/assets-bundles.html' %}
    {% include 'assets/bundles/requests-bundles.html' %}

    {% assets_static 'js/modals/confirm-request.js' %}
    {% assets_static 'js/modals/single-request.js' %}

    <script type="application/javascript">
        // Bootstrap Nav Active System
        // Save the latest tab and load it on page load
        document.addEventListener('DOMContentLoaded', function () {
            var activeTab = localStorage.getItem('assets-activeTab');
            if (activeTab) {
                var storedTab = document.querySelector('a[href="' + activeTab + '"]');
                if (storedTab) {
                    var tab = new bootstrap.Tab(storedTab);
                    tab.show();
                }
            } else {
                var firstTab = document.querySelector('#aa-assets-tabs a[data-bs-toggle="tab"]');
                if (firstTab) {
                    var tab = new bootstrap.Tab(firstTab);
                    tab.show();
                }
            }

            document.querySelectorAll('#aa-assets-tabs a[data-bs-toggle="tab"]').forEach(function (tabLink) {
                tabLink.addEventListener('click', function (e) {
                    e.preventDefault();
                    var tabName = this.getAttribute('href');
                    localStorage.setItem('assets-activeTab', tabName);
                    if (history.pushState) {
                        history.pushState(null, null, tabName);
                    }
                });
            });
        });
    </script>
{% endblock extra_javascript %}
